{
  "hash": "008ab20fbc8fe113c301b0206c2d6763",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Extracting Data from PDFs documents using tabulapdf in R\"\nsubtitle: \"Part 1\"\nauthor: \"Muhammad Yaseen, Zahid Asghar \"\ndate: \"2024-06-09\"\ncategories: [R, PDF, Data Extraction]\nformat: \n  html:\n    toc: true\n    toc-float: true\n    toc_depth: 3\n    code_folding: show\n    number_sections: true\n    highlight-style: dracula\neditor: visual\nexecute: \n  freeze: auto\n  warning: false\n  message: false\n---\n\n\n\n![](pdf.webp){width=100%}\n\n## Introduction\n\nIn this blog post, we will explore how to extract data from PDF files using the `tabulapdf` package in R. PDF is a common file format for sharing data, but extracting structured data from PDFs can be challenging. The `tabulapdf` package provides an easy way to extract tables from PDFs and convert them into a usable format.\n\n## Importance of Extracting Data from PDFs\n\nExtracting tables from PDF files is crucial for several reasons:\n\n1. **Data Accessibility**: Many important documents and reports are shared in PDF format. Extracting data from these documents makes it accessible for analysis and further use.\n2. **Automated Data Processing**: Manual data entry from PDFs is time-consuming and prone to errors. Automated extraction ensures accuracy and efficiency.\n3. **Data Integration**: Extracting data from PDFs allows for the integration of information from various sources, enhancing the comprehensiveness of data analysis.\n4. **Historical Data Analysis**: Many historical documents are available only in PDF format. Extracting data from these PDFs allows for the analysis of trends over time.\n5. **Enhanced Decision Making**: Having access to data in an analyzable format helps in making informed decisions based on comprehensive data analysis.\n\nSo extracting tables from PDFs is a critical skill that enables access to important data, ensures accuracy, and saves time in data processing.We can automate the process and make the data extraction workflow more efficient. This not only improves productivity but also ensures that the data extracted is accurate and reliable, providing a solid foundation for any subsequent analysis or decision-making processes.\n\nGiven these reasons, it's evident why efficient tools for extracting data from PDFs are invaluable. So lets learn how to extract data from PDFs using the `tabulapdf` package in R.\n\n## Required Libraries\n\nI have tried `tabulizer` to install but not successful. I have come across `tabulapdf` package and find it very handy. To begin, we'll need to install and load the necessary libraries. Here is the list of packages we'll be using:\n\n- `rJava`\n- `tabulapdf`\n- `pdftools`\n- `tidyverse`\n\nLet's load these libraries in R.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSys.setenv(JAVA_HOME = \"C:/Program Files/Java/jdk-22\") ## One check is for one's system if required for running `rJava`\nlibrary(rJava)\nlibrary(tabulapdf)\nlibrary(pdftools)\nlibrary(tidyverse)\n```\n:::\n\n\n\n## Extracting Tables from a PDF \n\n\n\n\nThe `extract_tables` function extracts tables from the specified page of the PDF file. In this case, we extracted the table from the first page of the sample PDF file.\n\n\n\n\n::: {#tbl-mtcars .cell tbl-cap='Extracted Table from the PDF'}\n\n```{.r .cell-code}\nf2 <- \"https://raw.githubusercontent.com/ropensci/tabulapdf/main/inst/examples/mtcars.pdf\"\n\nextract_tables(f2, pages = 1) \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[1]]\n# A tibble: 5 × 12\n  model          mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb\n  <chr>        <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n1 Mazda RX4     21       6   160   110  3.9   2.62  16.5     0     1     4     4\n2 Mazda RX4 W…  21       6   160   110  3.9   2.88  17.0     0     1     4     4\n3 Datsun 710    22.8     4   108    93  3.85  2.32  18.6     1     1     4     1\n4 Hornet 4 Dr…  21.4     6   258   110  3.08  3.21  19.4     1     0     3     1\n5 Hornet Spor…  18.7     8   360   175  3.15  3.44  17.0     0     0     3     2\n```\n\n\n:::\n:::\n\n\n\n@tbl-mtcars indicates that the table has been successfully extracted from the PDF file. We can now proceed to convert this table into a data frame for further analysis.\n\nNow we will extract a table from a specific page of another PDF file. This PDF is a monthly report on Consumer Price Index from the Pakistan Bureau of Statistics.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# URL of the monthly review PDF\nf1 <- \"https://www.pbs.gov.pk/sites/default/files/price_statistics/cpi/may/Monthly%20Review%20May%2C%202024.pdf\"\n```\n:::\n\n\n\n\n::: {#fig-cpi}\n\n![](cpi.png)\n\nGeneral Inflation (%) \n::: \n\nOne can see from @fig-cpi that the table we want to extract is on the third page of the PDF. Let's extract the table from the third page of the PDF file.\n\n\n\n::: {#tbl-cpi .cell tbl-cap='Extracted Table from the PDF'}\n\n```{.r .cell-code}\n# Extract and view the table from the third page of the PDF\nextract_tables(f1, pages = 3)[[1]] |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 7\n  `Table 1.a` ...2      ...3      General Inflation (%)(Base…¹ ...5  ...6  ...7 \n  <chr>       <chr>     <chr>     <chr>                        <chr> <chr> <chr>\n1 <NA>        <NA>      <NA>      CPI                          <NA>  <NA>  <NA> \n2 <NA>        <NA>      General   Food                         Non-… SPI** WPI  \n3 PERIOD      National  Urban     Rural Urban Rural            Urba… <NA>  <NA> \n4 <NA>        YoY MoM   YoY MoM   YoY MoM YoY MoM YoY MoM      YoY … YoY … YoY …\n5 Aug-22      27.3 2.4  26.2 2.6  28.8 2.2 28.8 1.6 30.2 1.2   24.7… 34.0… 41.2…\n6 Sep-22      23.2 -1.2 21.2 -2.1 26.1 0.2 30.8 5.2 32.7 5.7   15.2… 28.6… 38.9…\n# ℹ abbreviated name: ¹​`General Inflation (%)(Base 2015-16)`\n```\n\n\n:::\n:::\n\n\n\n@tbl-cpi indicates that the table has been successfully extracted from the PDF file. We can now proceed to convert this table into a data frame for further analysis.\n\n## Converting Extracted Table to Data Frame\n\nAfter extracting the table, we need to convert it into a data frame and clean the data for further analysis.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable <- extract_tables(f1, pages = 3)[[1]]\n\n# Convert the extracted table to a data frame\ntable_df <- as.data.frame(table)\n\n# Skip the first four rows\ntable_filtered <- table_df %>% slice(-(1:4))\n\n# Combine the rows into a single text string\ntable_text <- apply(table_filtered, 1, paste, collapse = \" \")\n\n# Split the text into columns\ntable_separated <- str_split_fixed(table_text, \"\\\\s+\", n = 19)  # Adjust 'n' based on the number of columns\n\n# Convert the separated text into a data frame\ntable_separated_df <- as.data.frame(table_separated)\n```\n:::\n\n\n\n## Renaming Columns \n\nWe will now rename the columns to make the data more readable and meaningful.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Rename the columns of the data frame\ncolnames(table_separated_df) <- c(\n  \"Period\", \n  \"CPI_general_yoy\", \"CPI_general_mom\", \n  \"CPI_general_yoy_urban\", \"CPI_general_mom_urban\", \n  \"CPI_general_yoy_rural\", \"CPI_general_mom_rural\", \n  \"CPI_food_yoy_urban\", \"CPI_food_mom_urban\", \n  \"CPI_food_yoy_rural\", \"CPI_food_mom_rural\", \n  \"CPI_non_food_yoy_urban\", \"CPI_non_food_mom_urban\", \n  \"CPI_non_food_yoy_rural\", \"CPI_non_food_mom_rural\", \n  \"SPI_yoy\", \"SPI_mom\", \n  \"WPI_yoy\", \"WPI_mom\"\n)\n```\n:::\n\n\n\n## Cleaned Data Frame\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntable_separated_df |> kableExtra::kable()\n```\n\n::: {.cell-output-display}\n\n\n|Period |CPI_general_yoy |CPI_general_mom |CPI_general_yoy_urban |CPI_general_mom_urban |CPI_general_yoy_rural |CPI_general_mom_rural |CPI_food_yoy_urban |CPI_food_mom_urban |CPI_food_yoy_rural |CPI_food_mom_rural |CPI_non_food_yoy_urban |CPI_non_food_mom_urban |CPI_non_food_yoy_rural |CPI_non_food_mom_rural |SPI_yoy |SPI_mom |WPI_yoy |WPI_mom |\n|:------|:---------------|:---------------|:---------------------|:---------------------|:---------------------|:---------------------|:------------------|:------------------|:------------------|:------------------|:----------------------|:----------------------|:----------------------|:----------------------|:-------|:-------|:-------|:-------|\n|Aug-22 |27.3            |2.4             |26.2                  |2.6                   |28.8                  |2.2                   |28.8               |1.6                |30.2               |1.2                |24.7                   |3.3                    |27.5                   |3.1                    |34.0    |5.2     |41.2    |3.1     |\n|Sep-22 |23.2            |-1.2            |21.2                  |-2.1                  |26.1                  |0.2                   |30.8               |5.2                |32.7               |5.7                |15.2                   |-6.6                   |20.1                   |-4.9                   |28.6    |-1.4    |38.9    |1.4     |\n|Oct-22 |26.6            |4.7             |24.6                  |4.5                   |29.5                  |5.0                   |34.7               |4.5                |37.2               |6.1                |18.2                   |4.5                    |22.4                   |3.9                    |24.0    |-1.5    |32.6    |-0.5    |\n|Nov-22 |23.8            |0.8             |21.6                  |0.4                   |27.2                  |1.3                   |29.7               |0.0                |33.5               |0.5                |16.4                   |0.6                    |21.4                   |2.1                    |27.1    |6.1     |27.7    |0.0     |\n|Dec-22 |24.5            |0.5             |21.6                  |0.3                   |28.8                  |0.7                   |32.7               |0.0                |37.9               |0.1                |14.8                   |0.6                    |20.7                   |1.4                    |27.8    |0.2     |27.1    |-0.7    |\n|Jan-23 |27.6            |2.9             |24.4                  |2.4                   |32.3                  |3.6                   |39.0               |3.9                |45.2               |5.7                |15.6                   |1.2                    |20.9                   |1.5                    |30.5    |1.3     |28.5    |1.8     |\n|Feb-23 |31.5            |4.3             |28.8                  |4.5                   |35.6                  |4.0                   |41.9               |4.3                |47.0               |3.9                |20.8                   |4.7                    |25.3                   |4.1                    |33.6    |3.7     |36.4    |8.2     |\n|Mar-23 |35.4            |3.7             |33.0                  |3.9                   |38.9                  |3.5                   |47.1               |5.6                |50.2               |4.5                |24.1                   |2.7                    |28.5                   |2.4                    |40.4    |5.8     |37.5    |4.7     |\n|May-23 |36.4            |2.4             |33.5                  |2.0                   |40.7                  |3.0                   |46.8               |3.4                |52.2               |4.2                |24.9                   |1.0                    |29.9                   |1.6                    |42.1    |2.7     |33.4    |0.1     |\n|May-23 |38.0            |1.6             |35.1                  |1.5                   |42.2                  |1.7                   |48.1               |1.9                |52.4               |1.4                |26.6                   |1.2                    |32.5                   |2.0                    |43.0    |1.3     |32.8    |1.0     |\n|Jun-23 |29.4            |-0.3            |27.3                  |0.1                   |32.4                  |-0.8                  |40.8               |0.1                |41.5               |-1.6               |18.7                   |0.1                    |23.8                   |0.1                    |34.9    |0.2     |22.4    |-0.3    |\n|Jul-23 |28.3            |3.5             |26.3                  |3.6                   |31.3                  |3.3                   |40.2               |3.7                |41.3               |3.5                |17.3                   |3.5                    |22.0                   |3.0                    |29.3    |2.8     |23.1    |2.5     |\n|Aug-23 |27.4            |1.7             |25.0                  |1.6                   |30.9                  |1.9                   |38.8               |0.6                |40.6               |0.8                |16.3                   |2.4                    |22.0                   |3.1                    |27.9    |4.1     |24.3    |4.2     |\n|Sep-23 |31.4            |2.0             |29.7                  |1.7                   |33.9                  |2.5                   |33.9               |1.5                |35.4               |1.8                |26.8                   |1.8                    |32.3                   |3.2                    |32.0    |1.7     |26.4    |3.1     |\n|Oct-23 |26.8            |1.0             |25.5                  |1.1                   |28.7                  |0.9                   |28.9               |0.6                |28.6               |0.7                |23.1                   |1.4                    |28.8                   |1.1                    |34.2    |0.2     |24.6    |-1.9    |\n|Nov-23 |29.2            |2.7             |30.4                  |4.3                   |27.5                  |0.4                   |29.8               |0.8                |29.2               |1.0                |30.9                   |7.0                    |25.9                   |-0.2                   |30.6    |3.3     |26.4    |1.4     |\n|Dec-23 |29.7            |0.8             |30.9                  |0.7                   |27.9                  |1.0                   |28.8               |-0.7               |29.3               |0.1                |32.4                   |1.8                    |26.4                   |1.8                    |35.3    |3.8     |27.3    |0.0     |\n|Jan-24 |28.3            |1.8             |30.2                  |1.8                   |25.7                  |1.9                   |27.4               |2.8                |25.1               |2.3                |32.3                   |1.1                    |26.3                   |1.4                    |36.2    |2.0     |27.0    |1.5     |\n|Feb-24 |23.1            |0.0             |24.9                  |0.2                   |20.5                  |-0.3                  |20.2               |-1.5               |19.0               |-1.1               |28.2                   |1.5                    |22.1                   |0.6                    |30.4    |-0.8    |18.7    |1.1     |\n|Mar-24 |20.7            |1.7             |21.9                  |1.4                   |19.0                  |2.1                   |16.6               |2.4                |17.1               |2.8                |25.8                   |0.7                    |21.0                   |1.4                    |25.9    |2.1     |14.8    |1.3     |\n|Apr-24 |17.3            |-0.4            |19.4                  |-0.1                  |14.5                  |-0.9                  |11.3               |-1.3               |9.5                |-2.6               |25.6                   |0.8                    |20.0                   |0.8                    |21.6    |-0.7    |13.9    |-0.7    |\n|May-24 |11.8            |-3.2            |14.3                  |-2.8                  |8.2                   |-3.9                  |2.2                |-6.3               |-0.1               |-7.4               |23.6                   |-0.4                   |17.2                   |-0.4                   |15.3    |-4.0    |9.9     |-2.5    |\n\n\n:::\n:::\n\n\n\n\n\n\n## Saving the Data to a CSV File and Excel File\n\nFinally, we can save the cleaned data to a CSV file for future use.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Save the table to a CSV file\nwrite.csv(table_separated_df, \"table_separated_df.csv\", row.names = FALSE)\n# Save the table to an Excel file\nwritexl::write_xlsx(table_separated_df, \"table_separated_df.xlsx\")\n```\n:::\n\n\n\n## Conclusion \n\nIn this post, we demonstrated how to extract tables from PDF files using the `tabulapdf` package in R. We walked through the steps of loading necessary libraries, extracting tables from PDFs, converting them to data frames, cleaning the data, and finally saving it to a CSV file. This process can be very useful for extracting and analyzing data from PDF reports and documents. \n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}